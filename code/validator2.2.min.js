/*
    jQuery Form Validator Plugin v2.0
    Copyright (c) 2011 Daniel Thomson
    https://github.com/dansdom/plugins-form-validator
    
    Licensed under the MIT license:
    http://www.opensource.org/licenses/mit-license.php
*/

(function(c){c.Validator=function(a,d,k){this.el=c(d);this.namespace="validator";this.opts=c.extend(!0,{},c.Validator.settings,a);this.theFormRequired=this.el.find("."+this.opts.formClasses.requiredClass);this.theFormOptional=this.el.find("."+this.opts.formClasses.optionalClass);this.theFormValidationFields=this.el.find("."+this.opts.formClasses.requiredClass+", ."+this.opts.formClasses.optionalClass);this.init();"function"===typeof k&&k.call()};c.Validator.settings={inputTypes:{textField:{inputName:"firstName", rules:{min:2,max:20,lettersOnly:!0,noSpaces:!0}},textMessage:{inputName:"message",rules:{min:5,max:100,validHTMLTags:"<div>,<p>,<span>,<b>"}},urlField:{inputName:"url",rules:{validURL:!0}},selectBox:{inputName:"selectbox",rules:{selectHasValue:!0,selectNull:"-please select-"},error:"Please select a value for this field",valid:"the field is valid - woot!"},radioBtn:{inputName:"radio1",rules:{radioReq:!0}},fileData:{inputName:"fileData",rules:{fileType:"doc,txt,html"}},checkboxField:{inputName:"checkboxField", rules:{checkboxMin:1}},date:{inputName:"dateField",rules:{date:!0}}},formClasses:{submitClass:"submitField",resetClass:"reset",requiredClass:"required",optionalClass:"optional",errorClass:"error",errorMessage:"The field has an error!",validClass:"valid",validMessage:"The field should be valid!",fieldActive:"fieldActive",fieldActiveValid:"fieldActiveValid",fieldActiveInvalid:"fieldActiveInvalid"},longMonths:"january february march april may june july august september october november december".split(" "), shortMonths:"jan feb mar apr may jun jul aug sep oct nov dec".split(" "),longDays:"monday tuesday wednesday thursday friday saturday sunday".split(" "),shortDays:"mon tue wed thu fri sat sun".split(" "),errorCount:0,onChangeValidation:!0,submitFunction:!1};c.Validator.prototype={init:function(){var a=this;this.destroy();this.theFormValidationFields.each(function(){c(this).on("focus."+a.namespace,function(){c(this).addClass(a.opts.formClasses.fieldActive)});c(this).on("blur."+a.namespace,function(){c(this).removeClass(a.opts.formClasses.fieldActive); c(this).removeClass(a.opts.formClasses.fieldActiveValid);c(this).removeClass(a.opts.formClasses.fieldActiveInvalid);""!==c(this).prop("value")&&a.validateField(c(this))});c(this).on("change."+a.namespace,function(){a.validateField(c(this))});c(this).on("keyup."+a.namespace,function(){""!==c(this).prop("value")&&!0==a.opts.onChangeValidation&&a.validateField(c(this))});if("checkbox"==c(this).attr("type")||"radio"==c(this).attr("type"))c(this).on("click."+a.namespace,function(){a.validateField(c(this))})}); this.el.on("submit."+a.namespace,function(){a.validateForm()});this.el.find("."+this.opts.formClasses.resetClass).on("click."+a.namespace,function(){this.form.find("."+this.opts.formClasses.errorClass).removeClass(this.opts.formClasses.validClass).removeClass(this.opts.formClasses.fieldActiveValid).removeClass(this.opts.formClasses.fieldActiveInvalid);this.form.find("."+this.opts.formClasses.errorClass).html("&#42;")})},validateForm:function(){var a=this;a.opts.errorCount=0;a.theFormRequired.each(function(){a.validateField(c(this))}); if(0===a.opts.errorCount)return"function"===typeof a.opts.submitFunction?(a.opts.submitFunction.call(),!1):!0;a.el.find("."+a.opts.formClasses.fieldActiveValid).removeClass(a.opts.formClasses.fieldActiveValid);return!1},validateField:function(a){var d=!1,k=a.attr("name"),b=a.prop("value"),e,m,l,g,h,f;0<a.children("option").length&&(b=a.children("option:selected").text());""===b&&(d=!0);for(f in this.opts.inputTypes)k==this.opts.inputTypes[f].inputName&&(e=this.opts.inputTypes[f].rules,m=this.opts.inputTypes[f].error, l=this.opts.inputTypes[f].valid);b&&(b=this.stripWhiteSpace(b));for(f in e)if(e.hasOwnProperty(f)){switch(f){case "min":b.length<e[f]&&(d=!0,g="Must be at least "+e[f]+" characters");break;case "max":b.length>e[f]&&(d=!0,g="Must be less than "+e[f]+" characters");break;case "minValue":parseFloat(b)<e[f]&&(d=!0,g="the value is lower than the minimum value");break;case "maxValue":parseFloat(b)>e[f]&&(d=!0,g="the value is higher than the maximum allowed");break;case "checkboxMin":h=c("input[name="+k+ "]:checked");h.length<e[f]&&(d=!0,g="More options need to be selected");break;case "checkboxMax":h=c("input[name="+k+"]:checked");h.length>e[f]&&(d=!0,g="More than the maximum allowable have been selected");break;case "radioReq":h=c("input[name="+k+"]:checked");1<h.length&&(d=!0,g="More than radio field has been selected");break;case "selectNull":b==e[f]&&(d=!0,g="Please select a value");break;case "fileType":this.isFileValid(b,e[f])||(d=!0,g="The wrong type of file has been selected");break;case "isNumber":e[f]&& !this.isNumber(b)&&(d=!0,g="The value is not a number");break;case "lettersOnly":e[f]&&!this.isText(b)&&(d=!0,g="The input can only be text");break;case "validPassword":e[f]&&!this.isValidPassword(b)&&(d=!0,g="The password has illegal characters");break;case "passConfirm":h=a.attr("title");h=c("input[type='password'][title="+h+"][name!="+k+"]").prop("value");b!=h&&(d=!0,g="The password does not match");break;case "validURL":e[f]&&!this.isValidURL(b)&&(d=!0,g="That is not a valid URL");break;case "validEmail":e[f]&& !this.isValidEmail(b)&&(d=!0,g="That is not a valid email address");break;case "date":!0===e[f]&&(h=this.getDateArray(b),h&&this.isValidDate(h)||(d=!0,g="The date format is not valid"));break;case "dateFuture":!0===e[f]&&(h=this.getDateArray(b),h&&"future"==this.dateTense(h)||(d=!0,g="The date needs to be in the future"));break;case "datePast":!0===e[f]&&(h=this.getDateArray(b),h&&"past"==this.dateTense(h)||(d=!0,g="The date needs to be in the past"));break;case "checkHTMLTags":!0===e[f]&&this.findHTML(b)&& (d=!0,g="The input contains HTML tags");break;case "validHTMLTags":e[f]&&this.findHTMLTags(b,e[f])&&(d=!0,g="The input contains non-valid HTML tags");break;case "noSpaces":e[f]&&1<b.split(" ").length&&(d=!0,g="There are spaces in the input")}!0===d?(h=m?m:g,c("."+this.opts.formClasses.errorClass+"[title='"+k+"']").html(h),a.removeClass("fieldActiveValid").addClass("fieldActiveInvalid"),this.opts.errorCount++):(h=l?l:this.opts.formClasses.validMessage,c("."+this.opts.formClasses.errorClass+"[title='"+ k+"']").html('<span class="'+this.opts.formClasses.validClass+'">'+h+"</span>"),a.removeClass("fieldActiveInvalid").addClass("fieldActiveValid"))}},isFileValid:function(a,d){var c=d.split(","),b=a.split("/"),b=b[b.length-1].split("."),b=b[b.length-1],e;for(e=0;e<c.length;e++)if(b==c[e])return!0;return!1},isValidURL:function(a){return/^(([\w]+:)?\/\/)?(([\d\w]|%[a-fA-f\d]{2,2})+(:([\d\w]|%[a-fA-f\d]{2,2})+)?@)?([\d\w][\-\d\w]{0,253}[\d\w]\.)+[\w]{2,4}(:[\d]+)?(\/([\-+_~.\d\w]|%[a-fA-f\d]{2,2})*)*(\?(&?([\-+_~.\d\w]|%[a-fA-f\d]{2,2})=?)*)?(#([\-+_~.\d\w]|%[a-fA-f\d]{2,2})*)?$/.test(a)}, isValidEmail:function(a){return/^((([a-z]|[0-9]|!|#|$|%|&|'|\*|\+|\-|\/|=|\?|\^|_|`|\{|\||\}|~)+(\.([a-z]|[0-9]|!|#|$|%|&|'|\*|\+|\-|\/|=|\?|\^|_|`|\{|\||\}|~)+)*)@((((([a-z]|[0-9])([a-z]|[0-9]|\-){0,61}([a-z]|[0-9])\.))*([a-z]|[0-9])([a-z]|[0-9]|\-){0,61}([a-z]|[0-9])\.)[\w]{2,4}|(((([0-9]){1,3}\.){3}([0-9]){1,3}))|(\[((([0-9]){1,3}\.){3}([0-9]){1,3})\])))$/.test(a)},stripWhiteSpace:function(a){return a.replace(/^\s+|\s+$/g,"")},hasWhiteSpace:function(a){return/[\s+]/.test(a)},haveValue:function(a){return""!== a.replace(/^\s+|\s+$/g,"")?!0:!1},isText:function(a){return!/[^a-zA-Z\s]/.test(a)},isUsername:function(a){return!/[^a-zA-Z0-9\_\s]/.test(a)},isNumber:function(a){return/^([\-\+]?[0-9]+[\.]?[0-9]+|[\-\+]?[\.]?[0-9]+){1}$/.test(a)},isMoney:function(a){var d=!1;void 0!=a.split(".")&&(d=a.split("."));return d&&2==d.length?3>d[1].length?!0:!1:!0},isValidPassword:function(a){return/^[a-zA-Z0-9!\@#\$%\^&\*\(\)\-\+=\.\?]+$/.test(a)},findHTMLTags:function(a,d){var c=a,b=d.split(","),e="",m;for(m in b)b.hasOwnProperty(m)&& (e=b[m].replace(/[<>]/g,""),e="</?"+e+"\\s?([a-zA-Z]+=[\"'][^>\"']+[\"']|[^>\"']+)*>",e=new RegExp(e,"gi"),c=c.replace(e,""));return/<\/?[a-zA-Z]+\s?([a-zA-Z]+=["'][^>"']+["']|[^>"']+)*>/.test(c)},getDateArray:function(a){var d,c,b,e;a=a.replace(",","");a=a.replace(/[\s]+?/g," ");a=a.split(/[\s\-\/]/);for(b=0;b<a.length;b++)""===a[b]&&(a.splice(b,1),b--);for(b in this.opts.longDays)if(this.opts.longDays.hasOwnProperty(b))for(e in a)a.hasOwnProperty(e)&&a[e]==this.opts.longDays[b]&&(d=!0,c=e);for(b in this.opts.shortDays)if(this.opts.shortDays.hasOwnProperty(b))for(e in a)a.hasOwnProperty(e)&& a[e]==this.opts.shortDays[b]&&(d=!0,c=e);for(b in a)a[b]&&(a[b]=a[b].replace(/(st)|(nd)|(rd)|(th)/gi,""));4===a.length&&!0===d&&a.splice(c,1);return 3==a.length?a:!1},isValidDate:function(a){var d=!1,c=!1,b=!1,e,m=/^[0-9]{1,2}$/,l,g,h=31;if(m.test(a[1])&&0<a[1]&&13>a[1])l=parseInt(a[1],10),d=!0;else{for(e in this.opts.longMonths)a[1].toLowerCase()==this.opts.longMonths[e]&&(l=parseInt(e,10)+1,d=!0);for(e in this.opts.shortMonths)a[1].toLowerCase()==this.opts.shortMonths[e]&&(l=parseInt(e,10)+1,d= !0)}m=/^([0-9]{2}|[0-9]{4})$/;m.test(a[2])&&(0<=a[2]&&100>a[2]||1E3<a[2]&&3E3>a[2])&&(g=a[2],c=!0);4==l||6==l||9==l||11==l?h=30:2===l&&(h=0!==g%4||0===g%100&&0!==g%400?28:29);0<a[0]&&a[0]<=h&&(b=!0);return!0===b&&!0===d&&!0===c?!0:!1},dateTense:function(a){var d,c;for(c in this.opts.longMonths)this.opts.longMonths.hasOwnProperty(c)&&(d=(a[1]+"").toLowerCase(),d==this.opts.longMonths[c]&&(a[1]=parseInt(c,10)+1));for(c in this.opts.shortMonths)this.opts.shortMonths.hasOwnProperty(c)&&(d=(a[1]+"").toLowerCase(), d==this.opts.shortMonths[c]&&(a[1]=parseInt(c,10)+1));a[1]-=1;100>a[2]&&(a[2]=parseInt(a[2],10)+2E3);d=new Date;d.setFullYear(a[2],a[1],a[0]);d=Math.round(d.getTime()/864E5);a=new Date;a=Math.round(a.getTime()/864E5);return d>a?"future":d<a?"past":"today"},option:function(a){this.opts=c.extend(!0,{},this.opts,a)},destroy:function(){console.log(this);this.el.off("."+this.namespace)}};c.fn.validator=function(a,d){var k;"string"===typeof a?(k=Array.prototype.slice.call(arguments,1),this.each(function(){var b= c.data(this,"validator");b?c.isFunction(b[a])&&"_"!==a.charAt(0)?b[a].apply(b,k):alert("the plugin contains no such method: "+a):alert("The plugin has not been initialised yet when you tried to call this method: "+a)})):this.each(function(){var b=c.data(this,"validator");b?b.option(a):c.data(this,"validator",new c.Validator(a,this,d))});return this}})(jQuery);